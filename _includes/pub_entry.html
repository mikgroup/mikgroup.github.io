{% assign pub = include.pub %}
{% assign prev_year = include.prev_year %}

{% capture pub_year %}{{ pub.venue | split: ',' | last | strip }}{% endcapture %}
{% if pub_year != prev_year %}
  {% assign prev_year = pub_year %}
  <tr><td colspan="2"><h4>{{ pub_year }}</h4></td></tr>
{% endif %}

<tr>
  <td style="width: 25%; vertical-align: top;" class="pub-image-cell">
    {% if pub.picture %}
      <img src="{{ pub.picture }}" alt="{{ pub.title }}" class="pub-image">
    {% endif %}
  </td>
  <td style="vertical-align: top;">
    <div class="publication-entry">
      <h5 class="pub-title">{{ pub.title }}</h5>
      <p class="pub-authors"><em>{{ pub.authors }}</em></p>
      <p class="pub-venue">{{ pub.venue }}</p>
      
      {% if pub.note %}
        <p style="margin-bottom: 0.5rem; font-size: 0.9rem; color: #666;">{{ pub.note }}</p>
      {% endif %}
      
      {% if pub.specialnote %}
        <p style="margin-bottom: 0.5rem; font-size: 0.9rem; color: #007bff; font-weight: bold;">{{ pub.specialnote }}</p>
      {% endif %}
      
      {% if pub.links %}
        <div class="publication-links">
          {% for link in pub.links %}
            {% if link.type == 'abstract' %}
              <button class="btn btn-sm btn-outline-secondary mr-1" onclick="toggleAbstract('{{ pub.title | slugify }}')">
                <i class="fa fa-file-text-o"></i> Abstract
              </button>
            {% elsif link.type == 'html' %}
              <a href="{{ link.url }}" class="btn btn-sm btn-outline-primary mr-1" target="_blank">
                <i class="fa fa-external-link"></i> HTML
              </a>
            {% elsif link.type == 'code' %}
              <a href="{{ link.url }}" class="btn btn-sm btn-outline-dark mr-1" target="_blank">
                <i class="fa fa-code"></i> Code
              </a>
            {% endif %}
          {% endfor %}
        </div>
        {% if pub.links contains 'abstract' %}
          <div id="abstract-{{ pub.title | slugify }}" class="abstract-content" style="display: none; margin-top: 0.5rem; padding: 0.5rem; background-color: #f8f9fa; border-radius: 4px; font-size: 0.9rem;">
            {{ pub.abstract | default: "Abstract not available." }}
          </div>
        {% endif %}
      {% endif %}
    </div>
  </td>
</tr>
